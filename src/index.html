<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçÖ</text></svg>"
    />
    <link rel="stylesheet" href="https://tiptap-markdown-editor.pages.dev/style.css" />
    <?!= include('Stylesheet'); ?>
  </head>
  <body>
    <div class="app-layout">
    <div class="app-left">
    <div class="app">
      <!-- Header -->
      <div class="header">
        <h1>Pomodoro Timer</h1>
      </div>

      <!-- Timer Card -->
      <div id="timer-card" class="timer-card" data-phase="idle">
        <div id="phase-label" class="phase-label">Ê∫ñÂÇôÂÆå‰∫Ü</div>
        <div id="pomodoro-dots" class="pomodoro-dots"></div>
        <div id="timer-display" class="timer-display">00:00</div>
        <div id="work-progress" class="work-progress" style="display:none"></div>
        <div
          id="pattern-selector"
          class="pattern-selector"
          style="display: none"
        >
          <select
            id="pattern-select"
            class="pattern-select"
            onchange="App.onPatternChange(this.value)"
          ></select>
        </div>

        <div
          id="interruption-badge"
          class="interruption-badge"
          style="display: none"
        ></div>

        <div class="timer-controls">
          <button
            id="btn-start"
            class="btn btn-primary"
            onclick="App.startWork()"
          >
            ÈñãÂßã
          </button>
        </div>

        <!-- Work controls: interrupt (shown during work) -->
        <div id="work-controls" class="timer-controls" style="display: none">
          <button class="btn btn-warning" onclick="App.startInterruption()">‰∏≠Êñ≠</button>
        </div>

        <!-- Break controls (shown during break) -->
        <div id="break-controls" class="timer-controls" style="display: none">
          <button class="btn btn-primary" onclick="App.completeBreak()">‰ºëÊÜ©„ÇíÁµÇ‰∫Ü</button>
        </div>

        <!-- Break done panel (shown after break ends) -->
        <div
          id="break-done-panel"
          class="break-done-panel"
          style="display: none"
        >
          <div class="break-done-message">‰ºëÊÜ©„ÅåÁµÇ„Çè„Çä„Åæ„Åó„Åü</div>
          <div class="break-done-actions">
            <button class="btn btn-primary" onclick="App.continueWork()">
              Ê¨°„ÅÆ„Çø„Ç§„Éû„Éº„Å∏
            </button>
            <button class="btn btn-secondary" onclick="App.endSession()">
              ‰ΩúÊ•≠„ÇíÁµÇ‰∫Ü
            </button>
          </div>
        </div>
      </div>

      <!-- Date Selector -->
      <div class="date-selector">
        <div class="date-header">
          <span id="date-header-label" class="date-header-label">‰ªäÊó•</span>
          <button id="date-today-btn" class="date-today-btn" onclick="DateSelector.goToToday()" style="display:none">‰ªäÊó•</button>
          <span class="date-calendar-wrapper" title="„Ç´„É¨„É≥„ÉÄ„Éº">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="1.5" y="3" width="13" height="11.5" rx="1.5"/><line x1="1.5" y1="6.5" x2="14.5" y2="6.5"/><line x1="5" y1="1" x2="5" y2="4.5"/><line x1="11" y1="1" x2="11" y2="4.5"/></svg>
            <input type="date" id="date-calendar-input" class="date-calendar-input" />
          </span>
        </div>
        <div class="week-strip-container">
          <button class="date-nav-btn week-nav-btn" onclick="DateSelector.prevWeek()" title="Ââç„ÅÆÈÄ±">&lsaquo;</button>
          <div id="week-strip" class="week-strip"></div>
          <button class="date-nav-btn week-nav-btn" onclick="DateSelector.nextWeek()" title="Ê¨°„ÅÆÈÄ±">&rsaquo;</button>
        </div>
      </div>

      <!-- Stats -->
      <div id="today-stats-card" class="stats-card">
        <h3>ÈõÜË®à</h3>
        <div class="stats-grid">
          <div class="stats-item">
            <div class="stats-value">
              <span id="stats-pomodoros">0</span
              ><span id="stats-abandoned" class="stats-abandoned"></span>
            </div>
            <div class="stats-label">ÂÆå‰∫Ü</div>
          </div>
          <div class="stats-item">
            <div class="stats-value" id="stats-work-time">0ÂàÜ</div>
            <div class="stats-label">‰ΩúÊ•≠</div>
          </div>
          <div class="stats-item">
            <div class="stats-value" id="stats-break-time">0ÂàÜ</div>
            <div class="stats-label">‰ºëÊÜ©</div>
          </div>
          <div class="stats-item">
            <div class="stats-value" id="stats-work-int-time">0ÂàÜ</div>
            <div class="stats-label">‰∏≠Êñ≠(‰ΩúÊ•≠)</div>
          </div>
          <div class="stats-item">
            <div class="stats-value" id="stats-nonwork-int-time">0ÂàÜ</div>
            <div class="stats-label">‰∏≠Êñ≠(‰ªñ)</div>
          </div>
        </div>
      </div>

      <!-- History -->
      <div class="history-card">
        <div class="history-header">
          <h3>Ë®òÈå≤</h3>
          <a
            id="spreadsheet-link"
            href="#"
            target="_blank"
            class="spreadsheet-link"
            style="display: none"
            >Ë©≥Á¥∞</a
          >
        </div>
        <ul id="history-list" class="history-list">
          <li class="history-empty">„Åæ„Å†Ë®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</li>
        </ul>
      </div>
    </div>
    </div><!-- .app-left -->
    <div class="app-right">
      <div class="tab-bar">
        <button class="tab-btn active" data-tab="memo">„É°„É¢</button>
        <button class="tab-btn" data-tab="record" style="display:none">‰ΩúÊ•≠Ë®òÈå≤</button>
        <button class="tab-btn" data-tab="interruption" style="display:none">‰∏≠Êñ≠</button>
        <button class="tab-btn" data-tab="viewer" style="display:none">„Éì„É•„Éº</button>
      </div>

      <!-- „É°„É¢„Çø„Éñ -->
      <div class="tab-content active" data-tab-content="memo">
        <div class="memo-layout">
          <div id="memo-sidebar" class="memo-sidebar">
            <div class="memo-sidebar-header">
              <input type="text" class="memo-search-input" placeholder="Ê§úÁ¥¢..." oninput="MemoSidebar.filterMemos()" />
              <button class="memo-new-btn" onclick="MemoSidebar.createMemo()" title="Êñ∞Ë¶è„É°„É¢">+</button>
            </div>
            <div class="memo-tag-filters"></div>
            <div class="memo-sidebar-list"></div>
          </div>
          <div class="memo-sidebar-toggle" onclick="MemoSidebar.toggleCollapse()" title="„Çµ„Ç§„Éâ„Éê„ÉºÂàáÊõø">
            <span class="memo-toggle-chevron"></span>
          </div>
          <div class="memo-editor-area">
            <div id="memo-editor-toolbar" class="memo-editor-toolbar" style="display:none">
              <span class="memo-toolbar-name"></span>
              <div class="memo-toolbar-tags"></div>
              <div class="memo-tag-adder">
                <button class="memo-tag-add-btn" title="„Çø„Ç∞„ÇíËøΩÂä†">+</button>
              </div>
            </div>
            <div id="memo-editor-container" class="editor-full-container"></div>
          </div>
        </div>
      </div>

      <!-- ‰ΩúÊ•≠Ë®òÈå≤„Çø„Éñ -->
      <div class="tab-content" data-tab-content="record" style="display:none">
        <div class="record-panel">
          <div class="panel-toolbar">
            <input id="record-category" type="text" placeholder="„Ç´„ÉÜ„Ç¥„É™" autocomplete="off" />
          </div>
          <div id="record-editor-container" class="editor-flex-container"></div>
          <div class="panel-footer">
            <div id="interruption-list" class="interruption-list" style="display:none"></div>
            <div id="record-form-actions" class="form-actions" style="display:none">
              <button class="btn btn-primary" onclick="RecordForm.submitAndDo('break')">‰ºëÊÜ©„Å∏</button>
              <button class="btn btn-secondary" onclick="RecordForm.submitAndDo('nextWork')">Ê¨°„ÅÆ„Çø„Ç§„Éû„Éº</button>
              <button class="btn btn-secondary" onclick="RecordForm.submitAndDo('endSession')">ÁµÇ‰∫Ü</button>
            </div>
          </div>
        </div>
      </div>

      <!-- „Éì„É•„Éº„Çø„Éñ -->
      <div class="tab-content" data-tab-content="viewer" style="display:none">
        <div class="viewer-panel">
          <div class="panel-toolbar viewer-toolbar">
            <div class="viewer-toolbar-info">
              <div id="viewer-title" class="viewer-title"></div>
              <div id="viewer-meta" class="viewer-meta"></div>
            </div>
            <label id="viewer-type-label" class="checkbox-label" style="display:none"
              ><input type="checkbox" id="viewer-type-work" checked />
              ‰ΩúÊ•≠„Å´Âê´„ÇÅ„Çã</label>
            <input id="viewer-category" type="text" placeholder="„Ç´„ÉÜ„Ç¥„É™" autocomplete="off" />
          </div>
          <div id="viewer-editor-container" class="editor-full-container"></div>
          <div class="panel-footer">
            <button id="viewer-save-btn" class="btn btn-primary" onclick="TabPanel.saveViewer()">‰øùÂ≠ò</button>
            <button class="btn btn-secondary" onclick="TabPanel.hideViewer()">Èñâ„Åò„Çã</button>
          </div>
        </div>
      </div>

      <!-- ‰∏≠Êñ≠„Çø„Éñ -->
      <div class="tab-content" data-tab-content="interruption" style="display:none">
        <div class="interruption-panel">
          <div class="panel-toolbar">
            <label class="checkbox-label"
              ><input type="checkbox" id="int-type-work" checked />
              ‰ΩúÊ•≠„Å´Âê´„ÇÅ„Çã</label>
            <input id="int-category" type="text" placeholder="„Ç´„ÉÜ„Ç¥„É™" autocomplete="off" />
          </div>
          <div id="int-note-editor-container" class="editor-flex-container"></div>
          <div class="panel-footer">
            <button class="btn btn-primary" onclick="App.endInterruption()">Ë®òÈå≤„Åó„Å¶‰ΩúÊ•≠„Å´Êàª„Çã</button>
            <button class="btn btn-secondary" onclick="App.discardInterruption()">‰∏≠Êñ≠„ÇíÁ†¥Ê£Ñ</button>
          </div>
        </div>
      </div>
    </div><!-- .app-right -->
    </div><!-- .app-layout -->

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
      <div class="spinner"></div>
    </div>

    <?!= include('Notification'); ?>
    <script src="https://tiptap-markdown-editor.pages.dev/tiptap-markdown-editor.iife.js"></script>
    <?!= include('TabPanel'); ?>
    <?!= include('MemoEditor'); ?>
    <?!= include('MemoSidebar'); ?>
    <?!= include('CategoryCombo'); ?>
    <?!= include('RecordForm'); ?>
    <?!= include('DateSelector'); ?>
    <?!= include('JavaScript'); ?>
  </body>
</html>
