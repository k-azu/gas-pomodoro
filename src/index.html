<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🍅</text></svg>"
    />
    <?!= include('Stylesheet'); ?>
    <?!= include('EditorStyles'); ?>
  </head>
  <body>
    <div class="app-layout">
    <div class="app-left">
    <div class="app">
      <!-- Header -->
      <div class="header">
        <h1>Pomodoro Timer</h1>
      </div>

      <!-- Timer Card -->
      <div id="timer-card" class="timer-card" data-phase="idle">
        <div id="phase-label" class="phase-label">準備完了</div>
        <div id="pomodoro-dots" class="pomodoro-dots"></div>
        <div id="timer-display" class="timer-display">25:00</div>
        <div
          id="pattern-selector"
          class="pattern-selector"
          style="display: none"
        >
          <select
            id="pattern-select"
            class="pattern-select"
            onchange="App.onPatternChange(this.value)"
          ></select>
        </div>

        <div
          id="interruption-badge"
          class="interruption-badge"
          style="display: none"
        ></div>

        <div class="timer-controls">
          <button
            id="btn-start"
            class="btn btn-primary"
            onclick="App.startWork()"
          >
            開始
          </button>
        </div>

        <!-- Interruption start button (shown during work) -->
        <div
          id="interruption-controls"
          class="interruption-controls"
          style="display: none"
        >
          <button class="btn btn-warning" onclick="App.startInterruption()">
            中断
          </button>
        </div>

        <!-- Break abort button (shown during break) -->
        <div
          id="break-abort-controls"
          class="timer-controls"
          style="display: none"
        >
          <button class="btn btn-secondary" onclick="App.skipBreak()">
            休憩をスキップ
          </button>
        </div>

        <!-- Break done panel (shown after break ends) -->
        <div
          id="break-done-panel"
          class="break-done-panel"
          style="display: none"
        >
          <div class="break-done-message">休憩が終わりました</div>
          <div class="break-done-actions">
            <button class="btn btn-primary" onclick="App.continueWork()">
              次のポモドーロへ
            </button>
            <button class="btn btn-secondary" onclick="App.endSession()">
              作業を終了
            </button>
          </div>
        </div>
      </div>

      <!-- Today Stats -->
      <div id="today-stats-card" class="stats-card">
        <h3>今日の集計</h3>
        <div class="stats-grid">
          <div class="stats-item">
            <div class="stats-value">
              <span id="stats-pomodoros">0</span
              ><span id="stats-abandoned" class="stats-abandoned"></span>
            </div>
            <div class="stats-label">完了</div>
          </div>
          <div class="stats-item">
            <div class="stats-value" id="stats-work-time">0分</div>
            <div class="stats-label">作業</div>
          </div>
          <div class="stats-item">
            <div class="stats-value" id="stats-break-time">0分</div>
            <div class="stats-label">休憩</div>
          </div>
          <div class="stats-item">
            <div class="stats-value" id="stats-work-int-time">0分</div>
            <div class="stats-label">中断(作業)</div>
          </div>
          <div class="stats-item">
            <div class="stats-value" id="stats-nonwork-int-time">0分</div>
            <div class="stats-label">中断(他)</div>
          </div>
        </div>
      </div>

      <!-- History -->
      <div class="history-card">
        <div class="history-header">
          <h3>今日の記録</h3>
          <a
            id="spreadsheet-link"
            href="#"
            target="_blank"
            class="spreadsheet-link"
            style="display: none"
            >詳細</a
          >
        </div>
        <ul id="history-list" class="history-list">
          <li class="history-empty">まだ記録がありません</li>
        </ul>
      </div>
    </div>
    </div><!-- .app-left -->
    <div class="app-right">
      <div class="tab-bar">
        <button class="tab-btn active" data-tab="memo">メモ</button>
        <button class="tab-btn" data-tab="record" style="display:none">作業記録</button>
        <button class="tab-btn" data-tab="interruption" style="display:none">中断</button>
        <button class="tab-btn" data-tab="viewer" style="display:none">ビュー</button>
        <button class="btn btn-secondary btn-small tab-action-btn"
                onclick="MemoEditor.clear()" data-tab-action="memo">クリア</button>
        <button class="btn btn-secondary btn-small tab-action-btn"
                onclick="TabPanel.hideViewer()" data-tab-action="viewer" style="display:none">閉じる</button>
      </div>

      <!-- メモタブ -->
      <div class="tab-content active" data-tab-content="memo">
        <div id="memo-editor-container" class="editor-full-container"></div>
      </div>

      <!-- 作業記録タブ -->
      <div class="tab-content" data-tab-content="record" style="display:none">
        <div class="record-panel">
          <div class="record-panel-header">
            <div class="form-group">
              <label for="record-category">カテゴリ</label>
              <select id="record-category">
                <option value="">-- 選択 --</option>
              </select>
              <div class="category-add-row">
                <input id="new-category-name" type="text" placeholder="新しいカテゴリ" />
                <button onclick="RecordForm.addCategory()">追加</button>
              </div>
            </div>
          </div>
          <div id="record-editor-container" class="editor-flex-container"></div>
          <div class="record-panel-footer">
            <div id="interruption-list" class="interruption-list" style="display:none"></div>
            <div id="record-form-actions-work" class="form-actions" style="display:none">
              <button class="btn btn-danger" onclick="App.abandon()">中止</button>
            </div>
            <div id="record-form-actions-normal" class="form-actions" style="display:none">
              <button class="btn btn-primary" onclick="RecordForm.submit()">記録して休憩へ</button>
            </div>
            <div id="record-form-actions-abandon" class="form-actions" style="display:none">
              <button class="btn btn-primary" onclick="RecordForm.submitAbandon(false)">セットを続ける</button>
              <button class="btn btn-secondary" onclick="RecordForm.submitAbandon(true)">作業を終了</button>
            </div>
          </div>
        </div>
      </div>

      <!-- ビュータブ -->
      <div class="tab-content" data-tab-content="viewer" style="display:none">
        <div class="viewer-panel">
          <div class="viewer-panel-header">
            <div class="viewer-header-top">
              <div>
                <div id="viewer-title" class="viewer-title"></div>
                <div id="viewer-meta" class="viewer-meta"></div>
              </div>
              <button id="viewer-save-btn" class="btn btn-primary btn-small" onclick="TabPanel.saveViewer()">保存</button>
            </div>
          </div>
          <div id="viewer-editor-container" class="editor-full-container"></div>
        </div>
      </div>

      <!-- 中断タブ -->
      <div class="tab-content" data-tab-content="interruption" style="display:none">
        <div class="interruption-panel">
          <div class="interruption-panel-header">
            <div class="interrupted-timer-label">中断経過時間</div>
            <div id="interruption-timer" class="interruption-timer">00:00</div>
            <div class="interrupted-form-row">
              <label class="radio-label"
                ><input type="radio" name="int-type" value="nonWork" checked />
                作業に含めない</label>
              <label class="radio-label"
                ><input type="radio" name="int-type" value="work" />
                作業に含める</label>
            </div>
            <select id="int-category" class="interrupted-form-select">
              <option value="">-- カテゴリ --</option>
            </select>
          </div>
          <div id="int-note-editor-container" class="editor-flex-container"></div>
          <div class="interruption-panel-footer">
            <button class="btn btn-primary" onclick="App.endInterruption()">記録して作業に戻る</button>
          </div>
        </div>
      </div>
    </div><!-- .app-right -->
    </div><!-- .app-layout -->

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
      <div class="spinner"></div>
    </div>

    <?!= include('Notification'); ?>
    <?!= include('EditorBundle'); ?>
    <?!= include('TabPanel'); ?>
    <?!= include('MemoEditor'); ?>
    <?!= include('RecordForm'); ?>
    <?!= include('JavaScript'); ?>
  </body>
</html>
