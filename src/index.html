<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçÖ</text></svg>"
    />
    <link rel="stylesheet" href="https://tiptap-markdown-editor.pages.dev/style.css" />
    <?!= include('Stylesheet'); ?>
  </head>
  <body>
    <div class="app-layout">
    <div class="app-left">
    <!-- Collapsed strip (visible only when collapsed) -->
    <div id="app-left-strip" class="app-left-strip" onclick="App.toggleLeftCollapse()">
      <div class="strip-time">00:00</div>
      <div class="strip-dots"></div>
    </div>
    <div class="app">
      <!-- Header -->
      <div class="header">
        <h1>Pomodoro Timer</h1>
        <button class="settings-gear-btn" onclick="SettingsPanel.show()" title="Ë®≠ÂÆö">&#9881;</button>
        <button class="left-collapse-btn" onclick="App.toggleLeftCollapse()" title="„Çµ„Ç§„Éâ„Éê„Éº„ÇíÊäò„Çä„Åü„Åü„ÇÄ">‚óÄ</button>
      </div>

      <!-- Timer Card -->
      <div id="timer-card" class="timer-card" data-phase="idle">
        <div id="phase-label" class="phase-label">Ê∫ñÂÇôÂÆå‰∫Ü</div>
        <div id="pomodoro-dots" class="pomodoro-dots"></div>
        <div id="timer-display" class="timer-display">00:00</div>
        <div id="work-progress" class="work-progress" style="display:none"></div>
        <div
          id="pattern-selector"
          class="pattern-selector"
          style="display: none"
        >
          <select
            id="pattern-select"
            class="pattern-select"
            onchange="App.onPatternChange(this.value)"
          ></select>
        </div>

        <div
          id="interruption-badge"
          class="interruption-badge"
          style="display: none"
        ></div>

        <div class="timer-controls">
          <button
            id="btn-start"
            class="btn btn-primary"
            onclick="App.startWork()"
          >
            ÈñãÂßã
          </button>
        </div>

        <!-- Work controls: interrupt (shown during work) -->
        <div id="work-controls" class="timer-controls" style="display: none">
          <button class="btn btn-warning" onclick="App.startInterruption()">‰∏≠Êñ≠</button>
        </div>

        <!-- Break controls (shown during break) -->
        <div id="break-controls" class="timer-controls" style="display: none">
          <button class="btn btn-primary" onclick="App.continueWork()">Ê¨°„ÅÆ„Çø„Ç§„Éû„Éº„Å∏</button>
          <button class="btn btn-secondary" onclick="App.endSession()">‰ΩúÊ•≠„ÇíÁµÇ‰∫Ü</button>
        </div>
      </div>

      <!-- Date Selector -->
      <div class="date-selector">
        <div class="date-header">
          <span id="date-header-label" class="date-header-label">‰ªäÊó•</span>
          <button id="date-today-btn" class="date-today-btn" onclick="DateSelector.goToToday()" style="display:none">‰ªäÊó•</button>
          <span class="date-calendar-wrapper" title="„Ç´„É¨„É≥„ÉÄ„Éº">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="1.5" y="3" width="13" height="11.5" rx="1.5"/><line x1="1.5" y1="6.5" x2="14.5" y2="6.5"/><line x1="5" y1="1" x2="5" y2="4.5"/><line x1="11" y1="1" x2="11" y2="4.5"/></svg>
            <input type="date" id="date-calendar-input" class="date-calendar-input" />
          </span>
        </div>
        <div class="week-strip-container">
          <button class="date-nav-btn week-nav-btn" onclick="DateSelector.prevWeek()" title="Ââç„ÅÆÈÄ±">&lsaquo;</button>
          <div id="week-strip" class="week-strip"></div>
          <button class="date-nav-btn week-nav-btn" onclick="DateSelector.nextWeek()" title="Ê¨°„ÅÆÈÄ±">&rsaquo;</button>
        </div>
      </div>

      <!-- Stats -->
      <div id="today-stats-card" class="stats-card">
        <h3>ÈõÜË®à</h3>
        <div class="stats-grid">
          <div class="stats-item">
            <div class="stats-value">
              <span id="stats-pomodoros">0</span
              ><span id="stats-abandoned" class="stats-abandoned"></span>
            </div>
            <div class="stats-label">ÂÆå‰∫Ü</div>
          </div>
          <div class="stats-item">
            <div class="stats-value" id="stats-work-time">0ÂàÜ</div>
            <div class="stats-label">‰ΩúÊ•≠</div>
          </div>
          <div class="stats-item">
            <div class="stats-value" id="stats-break-time">0ÂàÜ</div>
            <div class="stats-label">‰ºëÊÜ©</div>
          </div>
          <div class="stats-item">
            <div class="stats-value" id="stats-work-int-time">0ÂàÜ</div>
            <div class="stats-label">‰∏≠Êñ≠(‰ΩúÊ•≠)</div>
          </div>
          <div class="stats-item">
            <div class="stats-value" id="stats-nonwork-int-time">0ÂàÜ</div>
            <div class="stats-label">‰∏≠Êñ≠(‰ªñ)</div>
          </div>
        </div>
      </div>

      <!-- History -->
      <div class="history-card">
        <div class="history-header">
          <h3>Ë®òÈå≤</h3>
          <a
            id="spreadsheet-link"
            href="#"
            target="_blank"
            class="spreadsheet-link"
            style="display: none"
            >Ë©≥Á¥∞</a
          >
        </div>
        <ul id="history-list" class="history-list">
          <li class="history-empty">„Åæ„Å†Ë®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</li>
        </ul>
      </div>
    </div>
    </div><!-- .app-left -->
    <div class="app-right">
      <div class="tab-bar">
        <button class="tab-btn active" data-tab="memo">„É°„É¢</button>
        <button class="tab-btn" data-tab="task">„Çø„Çπ„ÇØ</button>
        <button class="tab-btn" data-tab="record" style="display:none">‰ΩúÊ•≠Ë®òÈå≤</button>
        <button class="tab-btn" data-tab="interruption" style="display:none">‰∏≠Êñ≠</button>
        <button class="tab-btn" data-tab="viewer" style="display:none">Ë®òÈå≤Ë©≥Á¥∞</button>
        <button class="tab-btn" data-tab="settings" style="display:none">Ë®≠ÂÆö</button>
      </div>

      <!-- „É°„É¢„Çø„Éñ -->
      <div class="tab-content active" data-tab-content="memo">
        <div class="memo-layout">
          <div id="memo-sidebar" class="memo-sidebar">
            <div class="memo-sidebar-header">
              <input type="text" class="memo-search-input" placeholder="Ê§úÁ¥¢..." oninput="MemoSidebar.filterMemos()" />
              <button class="memo-new-btn" onclick="MemoSidebar.createMemo()" title="Êñ∞Ë¶è„É°„É¢">+</button>
            </div>
            <div class="memo-tag-filters"></div>
            <div class="memo-sidebar-list"></div>
          </div>
          <div class="memo-sidebar-toggle" onclick="MemoSidebar.toggleCollapse()" title="„Çµ„Ç§„Éâ„Éê„ÉºÂàáÊõø">
            <span class="memo-toggle-chevron"></span>
          </div>
          <div class="memo-editor-area">
            <div id="memo-editor-toolbar" class="memo-editor-toolbar" style="display:none">
              <button id="memo-back-btn" class="memo-back-btn" style="display:none"
                onclick="MemoEditor.navigateBack()">&larr;</button>
              <span class="memo-toolbar-name"></span>
              <div id="memo-tag-picker-area"></div>
            </div>
            <div id="memo-editor-container" class="editor-full-container"></div>
          </div>
        </div>
      </div>

      <!-- „Çø„Çπ„ÇØ„Çø„Éñ -->
      <div class="tab-content" data-tab-content="task" style="display:none">
        <div class="task-layout">
          <div id="task-sidebar" class="task-sidebar">
            <div class="task-sidebar-header">
              <span class="task-sidebar-title">„Éó„É≠„Ç∏„Çß„ÇØ„Éà</span>
              <button class="memo-new-btn" onclick="TaskPanel.addProject()" title="„Éó„É≠„Ç∏„Çß„ÇØ„ÉàËøΩÂä†">+</button>
            </div>
            <div id="task-tree" class="task-tree"></div>
          </div>
          <div class="task-sidebar-toggle" onclick="TaskPanel.toggleSidebar()" title="„Çµ„Ç§„Éâ„Éê„ÉºÂàáÊõø">
            <span class="memo-toggle-chevron"></span>
          </div>
          <div class="task-content-area">
            <div id="task-content">
              <div class="task-content-placeholder">„Éó„É≠„Ç∏„Çß„ÇØ„Éà„Åæ„Åü„ÅØ„Çø„Çπ„ÇØ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
            </div>
          </div>
        </div>
      </div>

      <!-- ‰ΩúÊ•≠Ë®òÈå≤„Çø„Éñ -->
      <div class="tab-content" data-tab-content="record" style="display:none">
        <div class="record-panel">
          <div class="panel-toolbar">
            <button class="btn-small btn-secondary"
                    onclick="RecordForm.copyFromPrevious()"
                    title="Áõ¥Ââç„ÅÆ‰ΩúÊ•≠Ë®òÈå≤„ÅÆÂÜÖÂÆπ„Çí„Ç≥„Éî„Éº">ÂâçÂõû„Çí„Ç≥„Éî„Éº</button>
            <span class="toolbar-label">„Ç´„ÉÜ„Ç¥„É™</span>
            <div id="record-category-area"></div>
            <span class="toolbar-label">„Çø„Çπ„ÇØ</span>
            <div id="record-task-area"></div>
          </div>
          <div id="record-editor-container" class="editor-flex-container"></div>
          <div class="panel-footer">
            <div id="interruption-list" class="interruption-list" style="display:none"></div>
            <div id="record-form-actions" class="form-actions" style="display:none">
              <button class="btn btn-primary" onclick="RecordForm.submitAndDo('break')">‰ºëÊÜ©„Å∏</button>
              <button class="btn btn-secondary" onclick="RecordForm.submitAndDo('nextWork')">Ê¨°„ÅÆ„Çø„Ç§„Éû„Éº</button>
              <button class="btn btn-secondary" onclick="RecordForm.submitAndDo('endSession')">ÁµÇ‰∫Ü</button>
            </div>
          </div>
        </div>
      </div>

      <!-- „Éì„É•„Éº„Çø„Éñ -->
      <div class="tab-content" data-tab-content="viewer" style="display:none">
        <div class="viewer-panel">
          <div class="panel-toolbar viewer-toolbar">
            <span id="viewer-time-group" class="viewer-time-group" style="display:none">
              ÈñãÂßã <input type="time" id="viewer-start-time" class="viewer-time-input" />
              - ÁµÇ‰∫Ü <input type="time" id="viewer-end-time" class="viewer-time-input" />
              <span id="viewer-duration"></span>
            </span>
            <label id="viewer-type-label" class="checkbox-label" style="display:none"
              ><input type="checkbox" id="viewer-type-work" checked />
              ‰ΩúÊ•≠„Å´Âê´„ÇÅ„Çã</label>
            <div id="viewer-category-area"></div>
          </div>
          <div id="viewer-editor-container" class="editor-full-container"></div>
          <div class="panel-footer">
            <button id="viewer-save-btn" class="btn btn-primary" onclick="TabPanel.saveViewer()">‰øùÂ≠ò</button>
            <button class="btn btn-secondary" onclick="TabPanel.hideViewer()">Èñâ„Åò„Çã</button>
          </div>
        </div>
      </div>

      <!-- ‰∏≠Êñ≠„Çø„Éñ -->
      <div class="tab-content" data-tab-content="interruption" style="display:none">
        <div class="interruption-panel">
          <div class="panel-toolbar">
            <label class="checkbox-label"
              ><input type="checkbox" id="int-type-work" checked />
              ‰ΩúÊ•≠„Å´Âê´„ÇÅ„Çã</label>
            <div id="int-category-area"></div>
          </div>
          <div id="int-note-editor-container" class="editor-flex-container"></div>
          <div class="panel-footer">
            <button class="btn btn-primary" onclick="App.endInterruption()">Ë®òÈå≤„Åó„Å¶‰ΩúÊ•≠„Å´Êàª„Çã</button>
            <button class="btn btn-secondary" onclick="App.discardInterruption()">‰∏≠Êñ≠„ÇíÁ†¥Ê£Ñ</button>
          </div>
        </div>
      </div>

      <!-- Ë®≠ÂÆö„Çø„Éñ -->
      <div class="tab-content" data-tab-content="settings" style="display:none">
        <div class="settings-panel">
          <div class="settings-header">
            <h3>Ë®≠ÂÆö</h3>
            <button class="btn btn-secondary btn-small" onclick="SettingsPanel.close()">Èñâ„Åò„Çã</button>
          </div>
          <div class="settings-scroll">
            <div class="settings-section">
              <div class="settings-section-title">„Çø„Ç§„Éû„Éº„Éë„Çø„Éº„É≥</div>
              <div id="settings-patterns"></div>
            </div>
            <div class="settings-section">
              <div class="settings-section-title">‰ΩúÊ•≠„Ç´„ÉÜ„Ç¥„É™</div>
              <div id="settings-work-cats"></div>
            </div>
            <div class="settings-section">
              <div class="settings-section-title">‰∏≠Êñ≠„Ç´„ÉÜ„Ç¥„É™</div>
              <div id="settings-int-cats"></div>
            </div>
          </div>
        </div>
      </div>
    </div><!-- .app-right -->
    </div><!-- .app-layout -->

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
      <div class="spinner"></div>
    </div>

    <script>
      function docSvg(size, color) {
        var s = size || 14;
        var c = color || "currentColor";
        return '<svg width="' + s + '" height="' + s + '" viewBox="0 0 16 16" fill="' + c + '"><path d="M4.5 1h5.09a1 1 0 0 1 .7.29l2.42 2.42a1 1 0 0 1 .29.7V14a1 1 0 0 1-1 1h-7.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zm4.5 1v3.5h3.5M5.5 8h5M5.5 10.5h5M5.5 13h3"/></svg>';
      }

      function checkSvg(size, color) {
        var s = size || 14;
        var c = color || "currentColor";
        return '<svg width="' + s + '" height="' + s + '" viewBox="0 0 14 14" fill="none" stroke="' + c + '" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="2.5 7 5.5 10.5 11.5 3.5"/></svg>';
      }
    </script>
    <?!= include('Notification'); ?>
    <script src="https://tiptap-markdown-editor.pages.dev/tiptap-markdown-editor.iife.js"></script>
    <?!= include('TabPanel'); ?>
    <?!= include('MemoEditor'); ?>
    <?!= include('MemoSidebar'); ?>
    <?!= include('TaskStore'); ?>
    <?!= include('TaskPanel'); ?>
    <?!= include('ItemPicker'); ?>
    <?!= include('RecordForm'); ?>
    <?!= include('DateSelector'); ?>
    <?!= include('SettingsPanel'); ?>
    <?!= include('JavaScript'); ?>
  </body>
</html>
